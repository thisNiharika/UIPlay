<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisualTune Generator - UIPlay</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Inter:wght@400;600&family=Fira+Code&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Your Custom Stylesheets -->
    <link rel="stylesheet" href="style.css"> 
    <link rel="stylesheet" href="filter.css">
</head>
<body>

<header>
    <a href="index.html" class="logo">UIPlay</a>
    <nav class="d-flex align-items-center">
        <ul class="nav-links">
            <li><a href="index.html">Playground</a></li>
            <li class="dropdown">
                <a class="nav-tools-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-offset="0,20">
                    Tools
                </a>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="neumorphism.html">ShadowMint</a></li>
                    <li><a class="dropdown-item" href="swindex.html">SwatchLab</a></li>
                    <li><a class="dropdown-item" href="scindex.html">StyleCraft</a></li>
                    <li><a class="dropdown-item" href="shadows.html">Box Shadows</a></li>
                    <li><a class="dropdown-item" href="animations.html">CSS Animations</a></li>
                    <li><a class="dropdown-item" href="filter.html">VisualTune</a></li>
                    <li><a class="dropdown-item" href="border.html">Edgelet</a></li>
                    <li><a class="dropdown-item" href="typography.html">TypeSmith</a></li>
                </ul>
            </li>
        </ul>
    </nav>
</header>

    <main>
        <div class="page-title">
            <h1>VisualTune Generator</h1>
            <p>Adjust the sliders to apply CSS filters to the image in real-time.</p>
        </div>

        <div class="generator-container">
            <div class="controls-panel">
                <div class="controls-header">
                    <h2>Controls</h2>
                    
                </div>

                <div class="control-group">
                    <label>Upload Image</label>
                    <input type="file" id="filter-image-upload" accept="image/*">
                </div>
                <!-- Sliders -->
                <div class="control-group">
                    <label>Blur: <span id="blur-value">0</span>px</label>
                    <input type="range" id="blur" min="0" max="20" value="0" data-unit="px">
                </div>
                <div class="control-group">
                    <label>Brightness: <span id="brightness-value">100</span>%</label>
                    <input type="range" id="brightness" min="0" max="200" value="100" data-unit="%">
                </div>
                <div class="control-group">
                    <label>Contrast: <span id="contrast-value">100</span>%</label>
                    <input type="range" id="contrast" min="0" max="200" value="100" data-unit="%">
                </div>
                <div class="control-group">
                    <label>Grayscale: <span id="grayscale-value">0</span>%</label>
                    <input type="range" id="grayscale" min="0" max="100" value="0" data-unit="%">
                </div>
                <div class="control-group">
                    <label>Hue Rotate: <span id="hue-rotate-value">0</span>deg</label>
                    <input type="range" id="hue-rotate" min="0" max="360" value="0" data-unit="deg">
                </div>
            </div>

            <div class="preview-panel">
                <h2><span>Live Preview</span> <button id="reset-btn" class="reset-btn">Reset</button></h2>
                
                <div class="preview-box">
                    <!-- The <img> tag is replaced by the <canvas> -->
                    <canvas id="filteredCanvas"></canvas>
                </div>
                <small class="instruction-text">Right-click on the image â†’ "Copy image"</small>

                <h2>Generated CSS</h2>
                <div class="code-output">
                    <button id="copy-css-btn" class="copy-btn">Copy</button>
                    <pre><code id="css-code-output"></code></pre>
                </div>
            </div>
        </div>
    </main>
   
    <!-- Bootstrap and Header JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="header.js"></script>
    
    <!-- Self-Contained Page Script with Canvas Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('filteredCanvas');
            const ctx = canvas.getContext('2d');
            const sliders = document.querySelectorAll('input[type="range"]');
            const uploadInput = document.getElementById('filter-image-upload');
            const cssCodeOutput = document.getElementById('css-code-output');
            const resetBtn = document.getElementById('reset-btn');
            const copyCssBtn = document.getElementById('copy-css-btn');

            const defaultValues = {
                blur: 0,
                brightness: 100,
                contrast: 100,
                grayscale: 0,
                'hue-rotate': 0
            };
            
            // Create a single Image object to be reused
            const img = new Image();
            img.crossOrigin = 'anonymous'; // Important for loading external images
            img.onload = () => drawImageWithFilters();

            // --- Core Functions ---
            function getFilterString() {
                let filterStr = '';
                sliders.forEach(slider => {
                    filterStr += `${slider.id}(${slider.value}${slider.dataset.unit}) `;
                });
                return filterStr.trim();
            }

            function drawImageWithFilters() {
                // Set canvas size to the actual size of the loaded image
                canvas.width = img.naturalWidth;
                canvas.height = img.naturalHeight;

                // Apply filters to the canvas context
                ctx.filter = getFilterString();
                
                // Draw the image onto the canvas
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            }

            function updateUI() {
                // Update all text value spans next to the labels
                sliders.forEach(slider => {
                    const valueSpan = document.getElementById(`${slider.id}-value`);
                    if (valueSpan) valueSpan.textContent = slider.value;
                });

                // Update the CSS code output block
                cssCodeOutput.textContent = `filter: ${getFilterString()};`;
                
                // Redraw the canvas only if the image is fully loaded
                if (img.complete && img.naturalWidth > 0) {
                    drawImageWithFilters();
                }
            }

            function resetAll() {
                sliders.forEach(slider => {
                    slider.value = defaultValues[slider.id];
                });
                updateUI(); // Update UI and redraw canvas
            }

            // --- Event Listeners ---
            sliders.forEach(slider => slider.addEventListener('input', updateUI));
            resetBtn.addEventListener('click', resetAll);
            copyCssBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(cssCodeOutput.textContent).then(() => {
                    copyCssBtn.textContent = 'Copied!';
                    setTimeout(() => { copyCssBtn.textContent = 'Copy'; }, 1500);
                });
            });

            uploadInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    // Use FileReader to get a Data URL, which triggers img.onload
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // --- Initial Load ---
            // Load a default image to start
            img.src = 'https://picsum.photos/id/1025/800/600';
            // Set initial UI state
            updateUI();
        });
    </script>
</body>
</html>